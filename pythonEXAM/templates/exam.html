<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¯•å· {{ paper_id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/" class="back-link">â† æ”¾å¼ƒè€ƒè¯•</a>
            <h2>æ¨¡æ‹Ÿè¯•å· {{ paper_id }}</h2>
        </div>

        <form id="exam-form">
            <div class="section-title">ä¸€ã€å•é€‰é¢˜ (æ¯é¢˜2åˆ†)</div>
            {% for q in paper.choice %}
            <div class="question-card" data-ans="{{ q.answer }}" id="card_{{ q.id }}">
                <p><strong>{{ loop.index }}. {{ q.question }}</strong></p>
                <div class="options-list">
                    {% for opt in q.options %}
                    <label class="option-item">
                        <input type="radio" name="c_{{ q.id }}" value="{{ ['A','B','C','D'][loop.index0] }}">
                        {{ ['A','B','C','D'][loop.index0] }}. {{ opt }}
                    </label>
                    {% endfor %}
                </div>
                <div class="question-footer">
                    <button type="button" class="btn-peek" onclick="toggleAns(this, '{{ q.answer }}')">ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ</button>
                </div>
            </div>
            {% endfor %}

            <div class="section-title">äºŒã€åˆ¤æ–­é¢˜ (æ¯é¢˜1åˆ†)</div>
            {% for q in paper.true_false %}
            <div class="question-card" data-ans="{{ q.answer }}">
                <p><strong>{{ loop.index }}. {{ q.question }}</strong></p>
                <div class="options-list">
                    <label class="option-item"><input type="radio" name="tf_{{ q.id }}" value="T"> âœ… æ­£ç¡®</label>
                    <label class="option-item"><input type="radio" name="tf_{{ q.id }}" value="F"> âŒ é”™è¯¯</label>
                </div>
                <div class="question-footer">
                    {% set ans_text = 'æ­£ç¡®' if q.answer == 'T' else 'é”™è¯¯' %}
                    <button type="button" class="btn-peek" onclick="toggleAns(this, '{{ ans_text }}')">ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ</button>
                </div>
            </div>
            {% endfor %}

            <div class="section-title">ä¸‰ã€å¡«ç©ºé¢˜ (æ¯é¢˜2åˆ†)</div>
            {% for q in paper.fill_in %}
            <div class="question-card" data-ans="{{ q.answer }}">
                <p><strong>{{ loop.index }}. {{ q.question }}</strong></p>
                <input type="text" name="fi_{{ q.id }}" class="fill-input" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ">
                <div class="question-footer">
                    <button type="button" class="btn-peek" onclick="toggleAns(this, '{{ q.answer }}')">ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ</button>
                </div>
            </div>
            {% endfor %}

            <button type="button" class="btn" style="width:100%; margin-top:30px;" onclick="submitPaper()">æäº¤è¯•å·</button>
        </form>
    </div>

    <script>
        // åˆ‡æ¢æ˜¾ç¤º/éšè—ç­”æ¡ˆ
        function toggleAns(btn, ans) {
            let nextEl = btn.parentNode.nextElementSibling;
            if (nextEl && nextEl.classList.contains('peek-box')) {
                nextEl.remove();
                btn.innerText = "ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ";
            } else {
                let box = document.createElement('div');
                box.className = 'peek-box';
                box.style.display = 'block';
                box.innerText = `ğŸ’¡ ç­”æ¡ˆï¼š${ans}`;
                btn.parentNode.parentNode.appendChild(box);
                btn.innerText = "ğŸ™ˆ éšè—ç­”æ¡ˆ";
            }
        }

        function submitPaper() {
            let score = 0;
            const cards = document.querySelectorAll('.question-card');
            
            cards.forEach(card => {
                const correct = card.getAttribute('data-ans');
                let userAns = '';
                
                const radio = card.querySelector('input[type="radio"]:checked');
                const text = card.querySelector('input[type="text"]');
                
                if (radio) userAns = radio.value;
                if (text) userAns = text.value.trim();

                const isCorrect = userAns.replace(/\s/g,'').toLowerCase() === correct.replace(/\s/g,'').toLowerCase();
                
                card.classList.remove('card-correct', 'card-wrong');

                if (isCorrect) {
                    score += 2; 
                    card.classList.add('card-correct');
                } else {
                    card.classList.add('card-wrong');
                    if(!card.querySelector('.ans-hint')) {
                        let hint = document.createElement('div');
                        hint.className = 'ans-hint';
                        hint.innerHTML = `âŒ ä½ çš„ç­”æ¡ˆï¼š${userAns || '(æœªå¡«)'} <br> âœ… æ­£ç¡®ç­”æ¡ˆ: <strong>${correct}</strong>`;
                        card.appendChild(hint);
                    }
                }
            });

            alert(`è€ƒè¯•ç»“æŸï¼\nä½ çš„é¢„ä¼°å¾—åˆ†: ${score}`);
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>